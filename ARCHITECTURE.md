# 应用架构图 (App Architecture Diagram)

```
┌───────────────────────────────────────────────────────────┐
│                     User Interface Layer                   │
│  ┌─────────────────────────────────────────────────────┐  │
│  │              MainActivity.kt                         │  │
│  │  - 显示剪贴板历史列表                                │  │
│  │  - 控制监听服务启动/停止                             │  │
│  │  - 处理用户交互（点击、长按）                         │  │
│  └────────────┬─────────────────────────┬────────────────┘  │
└───────────────┼─────────────────────────┼───────────────────┘
                │                         │
                │ observes                │ controls
                │                         │
┌───────────────▼─────────────────────────▼───────────────────┐
│                   Business Logic Layer                       │
│  ┌─────────────────────────────────────────────────────┐   │
│  │          ClipboardViewModel.kt                       │   │
│  │  - 管理LiveData                                      │   │
│  │  - 协调Repository操作                                │   │
│  │  - 处理数据流转                                      │   │
│  └────────────┬────────────────────────────────────────┘   │
│               │                                             │
│  ┌────────────▼────────────────────────────────────────┐   │
│  │     ClipboardMonitorService.kt                       │   │
│  │  - 监听系统剪贴板变化                                │   │
│  │  - 后台运行服务                                      │   │
│  │  - 触发数据保存                                      │   │
│  └────────────┬────────────────────────────────────────┘   │
└───────────────┼──────────────────────────────────────────────┘
                │
                │ uses
                │
┌───────────────▼──────────────────────────────────────────────┐
│                     Data Layer                                │
│  ┌──────────────────────────────────────────────────────┐   │
│  │       ClipboardRepository.kt                          │   │
│  │  - 数据访问抽象层                                     │   │
│  │  - 去重逻辑                                           │   │
│  │  - CRUD操作封装                                       │   │
│  └────────────┬─────────────────────────────────────────┘   │
│               │                                              │
│  ┌────────────▼─────────────────────────────────────────┐   │
│  │           ClipboardDao.kt (Interface)                 │   │
│  │  - 定义数据库操作方法                                 │   │
│  │  - Room DAO接口                                       │   │
│  └────────────┬─────────────────────────────────────────┘   │
│               │                                              │
│  ┌────────────▼─────────────────────────────────────────┐   │
│  │        ClipboardDatabase.kt                           │   │
│  │  - Room数据库实例                                     │   │
│  │  - Singleton模式                                      │   │
│  └────────────┬─────────────────────────────────────────┘   │
│               │                                              │
│  ┌────────────▼─────────────────────────────────────────┐   │
│  │        ClipboardEntry.kt (Entity)                     │   │
│  │  - 数据模型                                           │   │
│  │  - 表结构定义                                         │   │
│  │    • id: Long (主键)                                  │   │
│  │    • content: String (内容)                           │   │
│  │    • timestamp: Long (时间戳)                         │   │
│  └──────────────────────────────────────────────────────┘   │
└───────────────────────────────────────────────────────────────┘

                          │
                          │ stores data in
                          ▼
        ┌─────────────────────────────────────┐
        │     Local SQLite Database            │
        │  /data/data/com.clipboard.manager/  │
        │  databases/clipboard_database        │
        └─────────────────────────────────────┘

┌───────────────────────────────────────────────────────────┐
│                    UI Components Layer                     │
│  ┌──────────────────────────────────────────────────────┐ │
│  │        ClipboardAdapter.kt                            │ │
│  │  - RecyclerView适配器                                │ │
│  │  - 绑定数据到列表项                                  │ │
│  │  - 处理点击事件                                      │ │
│  └──────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────┘
```

## 数据流向 (Data Flow)

### 1. 保存剪贴板内容 (Save Clipboard Content)
```
用户复制文本
    ↓
系统剪贴板变化
    ↓
ClipboardMonitorService监听到变化
    ↓
Service调用Repository.insert()
    ↓
Repository检查是否重复
    ↓
DAO执行数据库插入
    ↓
数据保存到SQLite
    ↓
LiveData自动通知观察者
    ↓
UI自动更新显示
```

### 2. 显示历史记录 (Display History)
```
MainActivity启动
    ↓
ViewModel订阅Repository.allEntries
    ↓
LiveData从数据库加载数据
    ↓
ViewModel转发数据给Activity
    ↓
ClipboardAdapter接收数据
    ↓
RecyclerView显示列表
```

### 3. 复制历史记录 (Copy from History)
```
用户点击列表项
    ↓
MainActivity.copyToClipboard()
    ↓
获取ClipboardManager系统服务
    ↓
创建ClipData对象
    ↓
设置到系统剪贴板
    ↓
显示Toast提示
```

### 4. 删除记录 (Delete Entry)
```
用户长按列表项
    ↓
显示确认对话框
    ↓
用户确认删除
    ↓
ViewModel.delete(entry)
    ↓
Repository.delete()
    ↓
DAO执行删除操作
    ↓
数据库更新
    ↓
LiveData通知更新
    ↓
UI自动刷新
```

## 技术特性 (Technical Features)

### MVVM架构
- **Model**: ClipboardEntry, ClipboardDatabase, ClipboardDao
- **View**: MainActivity, activity_main.xml, item_clipboard.xml
- **ViewModel**: ClipboardViewModel

### 异步处理
- 使用Kotlin协程 (Coroutines)
- 所有数据库操作在IO线程执行
- UI操作在主线程

### 响应式编程
- LiveData自动更新UI
- 观察者模式
- 数据驱动UI

### 依赖注入
- Repository模式
- 单例数据库
- 依赖通过构造函数注入

### 数据持久化
- Room ORM框架
- SQLite数据库
- 自动数据迁移支持
